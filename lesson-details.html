<!doctype html>
<html lang="ko" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="MacJae" />
    <meta name="keywords" content="다킹" />
    <meta name="description" content="다킹" />

    <!-- sns share -->
    <meta property="og:url" content="https://diet-king-app.netlify.app/" />
    <meta property="og:title" content="다킹" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/img/main.png" />
    <meta property="og:description" content="다킹" />

    <!--favicon-->
    <link rel="shortcut icon" href="/img/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="/img/favicon.ico" />
    <title>레슨 일지 작성</title>
    <style>
      /* 기존 스타일은 그대로 유지됩니다 */
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin-top: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        height: 100vh;
        overflow: hidden;
      }
      .container {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 1000px;
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        height: 80vh;
        max-height: 100%;
        overflow: auto;
        position: relative; /* 추가된 부분 */
      }

      .logout-btn {
        background-color: #ff5a5f;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 12px;
        position: absolute;
        top: 35px;
        right: 25px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        margin-top: 40px;
      }

      .logout-btn:hover {
        background-color: #ff3b3f;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        transform: translateY(-2px);
      }
      .header {
        position: relative;
        text-align: center;
        margin-bottom: 20px;
      }

      #clientName {
        font-size: 24px;
        color: #333;
        margin: 0;
        padding: 20px 0;
      }
      #viewReadOnlyBtn {
        margin-bottom: 100px;
      }
      .exercise-group {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
        background-color: #fff;
        position: relative;
      }

      .exercise-group:last-child {
        margin-bottom: 0;
      }

      .form-group {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
        font-size: 12px;
        resize: vertical;
        margin-bottom: 5px;
        margin-top: 30px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #555;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
        font-size: 12px;
      }

      .form-group textarea {
        resize: vertical;
      }

      .btn {
        width: 100%;
        padding: 12px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        text-align: center;
        font-size: 12px;
      }

      .btn:hover {
        background-color: #0056b3;
      }

      .add-remove-buttons {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
      }

      .add-remove-buttons button {
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 5px;
      }

      .remove-btn {
        background-color: #dc3545;
      }

      .remove-btn:hover {
        background-color: #c82333;
      }

      .add-btn:hover {
        background-color: #0056b3;
      }

      .exercise-group-table {
        width: 100%;
        border-collapse: collapse;
      }

      .exercise-group-table th,
      .exercise-group-table td {
        border: 1px solid #ddd;
        padding: 2px;
        text-align: center;
      }

      .exercise-group-table th {
        background-color: #f4f4f4;
      }

      .add-group-btn {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }

      .add-group-btn button {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
      }

      .add-group-btn button:hover {
        background-color: #0056b3;
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-btn:hover {
        background-color: #c82333;
      }

      .youtube-search-btn {
        display: inline-block;
        padding: 5px 10px;
        background-color: #ff0000;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
        text-align: center;
        margin-top: 0px;
      }

      .youtube-search-btn:hover {
        background-color: #cc0000;
      }

      .header h1 {
        text-align: center;
      }
      .next_lesson {
        width: 100%; /* 부모 요소의 너비를 100%로 설정 */
        margin-top: 20px; /* 위쪽 여백 추가 */
      }

      .next_lesson textarea {
        width: 100%; /* 부모 요소에 꽉 차도록 설정 */
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
        font-size: 12px;
        resize: vertical; /* 수직으로만 크기 조절 가능 */
      }
      #exerciseName1 {
        width: 60%;
      }
      #exerciseBodyPart11 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName2 {
        width: 60%;
      }
      #exerciseBodyPart12 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName3 {
        width: 60%;
      }
      #exerciseBodyPart13 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName4 {
        width: 60%;
      }
      #exerciseBodyPart14 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName5 {
        width: 60%;
      }
      #exerciseBodyPart15 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName6 {
        width: 60%;
      }
      #exerciseBodyPart16 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName7 {
        width: 60%;
      }
      #exerciseBodyPart17 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName8 {
        width: 60%;
      }
      #exerciseBodyPart18 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName9 {
        width: 60%;
      }
      #exerciseBodyPart19 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      #exerciseName10 {
        width: 60%;
      }
      #exerciseBodyPart20 {
        width: 60%;
        height: 20px;
        margin-bottom: 5px;
      }
      .navbar {
        width: 100%;
        background-color: #343a40;
        position: fixed;
        bottom: 0;
        left: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        height: 60px;
      }

      .navbar ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .navbar ul li {
        margin: 0 20px;
      }

      .navbar ul li a {
        color: white;
        text-decoration: none;
        font-size: 12px;
        padding: 10px 20px;
        transition:
          background-color 0.3s ease,
          transform 0.3s ease;
        border-radius: 25px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .navbar ul li a:hover {
        background-color: #495057;
        transform: translateY(-2px);
      }
      .btn1 {
        width: 100%;
        max-width: 500px;
        padding: 15px;
        background-color: #343a40; /* navbar와 동일한 색상 */
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        text-align: center;
        font-size: 12px;
        font-weight: 600;
        margin-top: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
      }
      @media (max-width: 600px) {
        .exercise-group-table th,
        .exercise-group-table td {
          font-size: 10px; /* 원하는 글자 크기로 조정 */
        }
        #clienName {
          font-size: 20px;
        }
        .form-group {
          font-size: 12px;
          margin-top: 30px;
        }
      }
      #exerciseName1,
      #exerciseName2,
      #exerciseName3,
      #exerciseName4,
      #exerciseName5,
      #exerciseName6,
      #exerciseName7,
      #exerciseName8,
      #exerciseName9,
      #exerciseName10 {
        width: 50%;
      }
      #exerciseBodyPart11,
      #exerciseBodyPart12,
      #exerciseBodyPart13,
      #exerciseBodyPart14,
      #exerciseBodyPart15,
      #exerciseBodyPart16,
      #exerciseBodyPart17,
      #exerciseBodyPart18,
      #exerciseBodyPart19,
      #exerciseBodyPart20 {
        width: 50%;
      }
      .exercise-group-table th,
      .exercise-group-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }

      .exercise-group-table th {
        background-color: #f4f4f4;
      }

      .exercise-group-table td:nth-child(1),
      .exercise-group-table th:nth-child(1) {
        width: 20%; /* 세트 열 너비 */
      }

      .exercise-group-table td:nth-child(2),
      .exercise-group-table th:nth-child(2) {
        width: 30%; /* 무게 열 너비 */
      }

      .exercise-group-table td:nth-child(3),
      .exercise-group-table th:nth-child(3) {
        width: 30%; /* 횟수 열 너비 */
      }
      .exercise-group-table input[type="number"] {
        height: 10px; /* 원하는 높이로 조정 */
        font-size: 12px;
        text-align: center;
      }
      .youtube-search-btn {
        width: 30%;
        margin-left: 1%;
        font-size: 12px;
        padding: 5px 6px;
      }
      /* 버튼 스타일 */
      .exercise-button {
        display: inline-block;
        padding: 10px 20px;
        margin: 5px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        text-align: center;
        text-decoration: none;
        transition: background-color 0.3s ease;
      }
      .exercise-button:hover {
        background-color: #0056b3;
      }
      .exercise-group {
        margin-top: 20px;
      }
      h4 {
        margin-bottom: -10px;
      }
      @media (max-width: 600px) {
        .btn1 {
          padding: 0;
        }
        .navbar {
          background-color: #333; /* 네비게이션 바 배경색 */
          padding: 0; /* 패딩 제거 */
          overflow-x: auto; /* 내용이 넘치면 스크롤바 표시 */
          white-space: nowrap; /* 줄바꿈 방지 */
        }

        .navbar-list {
          display: flex; /* 플렉스 박스로 변경하여 한 줄로 표시 */
          justify-content: space-between; /* 각 항목이 여유롭게 배치되도록 설정 */
          padding: 0;
          margin: 0;
          list-style: none; /* 리스트 스타일 제거 */
        }

        .navbar-list li {
          flex: 1; /* 각 항목이 균등하게 공간을 차지 */
        }

        .navbar-list a {
          display: block; /* 앵커 태그가 전체 공간을 차지하도록 설정 */
          padding: 10px 15px; /* 여백 추가 */
          color: white; /* 텍스트 색상 */
          text-align: center; /* 텍스트 중앙 정렬 */
          font-size: 14px; /* 폰트 크기 */
          text-decoration: none; /* 밑줄 제거 */
          white-space: nowrap; /* 줄바꿈 방지 */
        }

        .navbar-list a:hover {
          background-color: #555; /* 마우스 오버 시 배경색 변경 */
        }
        .navbar ul li a {
          font-size: 10px;
        }
        .navbar {
          width: 100%; /* 네비게이션 바가 화면 전체 너비를 차지하도록 설정 */
        }

        .lesson-box {
          display: flex; /* Flexbox 사용 */
          flex-direction: row; /* 가로 방향으로 배치 */
          align-items: center; /* 중앙 정렬 */
          justify-content: space-between; /* 양 끝에 배치 */
          padding: 10px; /* 패딩 줄이기 */
          gap: 10px; /* 글자와 버튼 사이의 간격 */
        }

        .lesson-box h3,
        .lesson-box h4 {
          font-size: 11px; /* 글자 크기 줄이기 */
          margin: 0; /* 여백 제거 */
        }

        .edit-delete-buttons {
          display: flex; /* Flexbox 사용 */
          flex-direction: row; /* 가로 방향으로 배치 */
          justify-content: center; /* 중앙 정렬 */
          margin-top: 5px; /* 간격 줄이기 */
        }

        .edit-btn,
        .delete-btn {
          padding: 5px 10px;
          font-size: 10px; /* 버튼 글자 크기 줄이기 */
        }

        .form-group {
          flex-direction: column; /* 세로로 배치 */
          gap: 10px; /* 요소들 간의 간격 */
        }

        .form-group input {
          width: 100%; /* 입력 필드가 전체 너비를 차지하도록 설정 */
        }

        .btn {
          width: 100%;
          max-width: none; /* 최대 너비 제한 제거 */
          font-size: 10px; /* 글자 크기 줄이기 */
        }

        .container {
          width: 100%; /* 모바일에서 컨테이너가 전체 너비를 차지하도록 설정 */

          padding: 10px; /* 패딩 줄이기 */
        }
        .btn1 {
          font-size: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 id="clientName">레슨 일지</h1>
        <button class="logout-btn" onclick="logout()">로그아웃</button>
      </div>
      <div id="message"></div>
      <div id="exerciseGroupsContainer">
        <!-- 운동 그룹들이 동적으로 추가될 위치 -->
      </div>
      <h4>다음 회차 예정 수업</h4>
      <div class="next_lesson">
        <textarea
          id="exerciseDescription${groupIndex}"
          rows="4"
          placeholder="다음 회차 예정 수업을 입력하세요"
        ></textarea>
      </div>

      <div class="add-group-btn">
        <button class="btn" id="addGroupBtn">종목 추가</button>
      </div>

      <input type="hidden" id="lessonId" />
      <button class="btn" id="saveLessonBtn">저장</button>
      <button class="btn" onclick="goBack()">뒤로 가기</button>
      <button class="btn" id="viewReadOnlyBtn">공유하기 페이지로 이동</button>
    </div>
    <nav class="navbar">
      <ul>
        <li>
          <button class="btn1" onclick="client_list()">회원목록</button>
        </li>
        <li>
          <button class="btn1" onclick="client_lesson_log()">수업목록</button>
        </li>
        <li>
          <button class="btn1" onclick="read_client_workout_log()">
            회원일지
          </button>
        </li>
        <li>
          <button class="btn1" onclick="progressrecord()">변화기록</button>
        </li>
        <li>
          <button class="btn1" onclick="Check_attendance_records()">
            출석 기록
          </button>
        </li>
      </ul>
    </nav>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>

    <script>
      // Firebase 설정
      const firebaseConfig = {
        apiKey: "AIzaSyCx_AlSQLpW-KpYXpk0M2mDxVb7CZa_xUk",
        authDomain: "diet-king-b567d.firebaseapp.com",
        projectId: "diet-king-b567d",
        storageBucket: "diet-king-b567d.appspot.com",
        messagingSenderId: "11155339798",
        appId: "1:11155339798:web:f689c9f8b8c772c65cc3e4",
        measurementId: "G-9NNCPJMT9M",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // 클라이언트 ID 가져오기
      function getClientId() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("clientId");
      }
      function getTrainerId() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("trainerId");
      }
      // 레슨 ID 가져오기
      function getLessonId() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("lessonId");
      }
      function client_list() {
        const clientId = getClientId();
        const trainerId = getTrainerId(); // 현재 URL에서 trainerId를 가져옴
        if (trainerId) {
          // trainerId를 URL에 포함하여 페이지로 이동
          window.location.href = `client_list.html?clientId=${clientId}&trainerId=${trainerId}`;
        } else {
          console.error("trainerId가 정의되지 않았습니다.");
        }
      }
      function Check_attendance_records() {
        const clientId = getClientId();
        const trainerId = getTrainerId(); // 현재 URL에서 trainerId를 가져옴
        if (trainerId) {
          // trainerId를 URL에 포함하여 페이지로 이동
          window.location.href = `Check_attendance_records.html?clientId=${clientId}&trainerId=${trainerId}`;
        } else {
          console.error("trainerId가 정의되지 않았습니다.");
        }
      }
      // 수정된 progressrecord 함수
      function progressrecord() {
        const clientId = getClientId();
        const trainerId = getTrainerId(); // 현재 URL에서 clientId를 가져옴
        if (clientId) {
          // clientId를 URL에 포함하여 페이지로 이동
          window.location.href = `progress-record.html?clientId=${clientId}&trainerId=${trainerId}`;
        } else {
          console.error("clientId가 정의되지 않았습니다.");
        }
      }
      function client_lesson_log() {
        const clientId = getClientId();
        const trainerId = getTrainerId(); // 현재 URL에서 clientId를 가져옴
        if (clientId) {
          // clientId를 URL에 포함하여 페이지로 이동
          window.location.href = `client_lesson_log.html?clientId=${clientId}&trainerId=${trainerId}`;
        } else {
          console.error("clientId가 정의되지 않았습니다.");
        }
      }
      function read_client_workout_log() {
        const clientId = getClientId();
        const trainerId = getTrainerId(); // 현재 URL에서 clientId를 가져옴
        if (clientId) {
          // clientId를 URL에 포함하여 페이지로 이동
          window.location.href = `read_client_workout_log.html?clientId=${clientId}&trainerId=${trainerId}`;
        } else {
          console.error("clientId가 정의되지 않았습니다.");
        }
      }
      document.addEventListener("DOMContentLoaded", function () {
        const addGroupBtn = document.getElementById("addGroupBtn");
        const saveLessonBtn = document.getElementById("saveLessonBtn");
        const exerciseGroupsContainer = document.getElementById(
          "exerciseGroupsContainer"
        );
        const viewReadOnlyBtn = document.getElementById("viewReadOnlyBtn");
        const lessonIdInput = document.getElementById("lessonId");

        // 레슨 데이터 로드 함수
        async function loadLessonData() {
          const lessonId = getLessonId();
          const clientId = getClientId();

          if (lessonId) {
            try {
              const lessonDoc = await db
                .collection("lessons")
                .doc(lessonId)
                .get();
              if (lessonDoc.exists) {
                const lessonData = lessonDoc.data();
                lessonIdInput.value = lessonId;

                const exerciseGroups = lessonData.exerciseGroups || [];
                exerciseGroups.forEach((group, index) => {
                  createExerciseGroup(group, index + 1);
                });

                document.querySelector(".next_lesson textarea").value =
                  lessonData.nextLesson || "";

                if (clientId) {
                  await loadClientCycleData(clientId, lessonData.cycle);
                } else {
                  console.log("클라이언트 ID가 입력되지 않았습니다.");
                }
              } else {
                console.log("레슨 문서를 찾을 수 없습니다.");
              }
            } catch (error) {
              console.error("레슨 데이터 로드 중 오류 발생:", error);
              alert("레슨 데이터를 로드하는 중 오류가 발생했습니다.");
            }
          } else {
            console.log("레슨 ID가 입력되지 않았습니다.");
          }
        }
        // 클라이언트 사이클 데이터 로드 함수
        async function loadClientCycleData(clientId, cycle) {
          // cycle 정보를 사용하여 클라이언트 이름 업데이트
          updateClientName(cycle);
        }

        // 클라이언트 이름 업데이트 함수
        function updateClientName(cycle) {
          const clientNameElement = document.getElementById("clientName");
          clientNameElement.textContent = `${cycle}회차 레슨 일지`;
        }
        // 운동 그룹 생성
        function createExerciseGroup(groupData = {}, index) {
          // 사용 가능한 인덱스 중 하나를 가져오거나 새 인덱스를 생성
          const groupIndex = index || Math.max(0, ...availableIndexes) + 1;
          availableIndexes.add(groupIndex); // 인덱스 집합에 추가

          const groupDiv = document.createElement("div");
          groupDiv.classList.add("exercise-group");
          groupDiv.id = `exerciseGroup${groupIndex}`;

          groupDiv.innerHTML = `
              <button class="close-btn" onclick="handleRemoveGroup('${groupDiv.id}')">&times;</button>
              <div class="form-group">
                  <label for="exerciseName${groupIndex}">종목 ${groupIndex}</label>
                  <input type="text" id="exerciseName${groupIndex}" placeholder="운동 이름을 입력하세요" />
                  <button class="youtube-search-btn" onclick="searchYouTube('${groupIndex}')">YouTube 검색</button>
              </div>
              <div class="form-group">
                  <label for="exerciseBodyPart${groupIndex}">부위</label>
                  <select id="exerciseBodyPart1${groupIndex}" onchange="recommendExercise(this)">
                      <option value="">선택</option>
                      <option value="가슴">가슴</option>
                      <option value="등">등</option>
                      <option value="하체">하체</option>
                      <option value="어깨">어깨</option>
                      <option value="이두">이두</option>
                      <option value="삼두">삼두</option>
                      <option value="복근">복근</option>
                      <option value="유산소">유산소</option>
                  </select>
                  <!-- 추천 운동을 표시하는 부분 -->
                  <div id="recommendation${groupIndex}" class="exercise-recommendation"></div>
              </div>
              <div class="form-group">
                  <label for="exerciseTable${groupIndex}">세트 정보</label>
                  <table id="exerciseTable${groupIndex}" class="exercise-group-table">
                      <thead>
                          <tr>
                              <th>세트(set)</th>
                              <th>무게(kg)</th>
                              <th>횟수(회)</th>
                          </tr>
                      </thead>
                      <tbody id="exerciseTableBody${groupIndex}">
                          <!-- 세트 정보가 여기에 추가됨 -->
                      </tbody>
                  </table>
              </div>
              <div class="feedback-section">
                  <div class="form-group">
                      <label for="exerciseDescription${groupIndex}">피드백</label>
                      <textarea id="exerciseDescription${groupIndex}" rows="4" placeholder="운동에 대한 피드백을 입력하세요"></textarea>
                  </div>
                  <div class="add-remove-buttons">
                      <button class="btn add-btn" id="addSetBtn${groupIndex}">+</button>
                      <button class="btn remove-btn" id="removeSetBtn${groupIndex}">-</button>
                  </div>
              </div>
          `;

          exerciseGroupsContainer.appendChild(groupDiv);

          // 부위가 이미 선택된 경우 추천 운동을 자동으로 업데이트
          if (groupData.bodyPart) {
            const selectElement = document.getElementById(
              `exerciseBodyPart1${groupIndex}`
            );
            selectElement.value = groupData.bodyPart;
            recommendExercise(selectElement);
          }

          document
            .getElementById("exerciseGroupsContainer")
            .appendChild(groupDiv);

          const addSetBtn = document.getElementById(`addSetBtn${groupIndex}`);
          const removeSetBtn = document.getElementById(
            `removeSetBtn${groupIndex}`
          );
          const exerciseTableBody = document.getElementById(
            `exerciseTableBody${groupIndex}`
          );

          let setCount = 0;

          addSetBtn.addEventListener("click", function () {
            setCount++;
            const row = document.createElement("tr");
            const setCell = document.createElement("td");
            setCell.textContent = setCount;
            row.appendChild(setCell);
            const weightCell = document.createElement("td");
            const weightInput = document.createElement("input");
            weightInput.type = "number";
            weightInput.placeholder = "무게(kg)";
            weightCell.appendChild(weightInput);
            row.appendChild(weightCell);
            const repsCell = document.createElement("td");
            const repsInput = document.createElement("input");
            repsInput.type = "number";
            repsInput.placeholder = "횟수(회)";
            repsCell.appendChild(repsInput);
            row.appendChild(repsCell);
            exerciseTableBody.appendChild(row);
          });

          removeSetBtn.addEventListener("click", function () {
            if (setCount > 0) {
              exerciseTableBody.removeChild(exerciseTableBody.lastChild);
              setCount--;
            }
          });

          // 기존 데이터 로드
          if (groupData) {
            const exerciseBodyPartSelect = document.getElementById(
              `exerciseBodyPart1${groupIndex}`
            );
            if (exerciseBodyPartSelect) {
              exerciseBodyPartSelect.value = groupData.bodyPart || "";
            }
            document.getElementById(`exerciseName${groupIndex}`).value =
              groupData.name || "";

            const exercises = groupData.exercises || [];
            exercises.forEach((exercise, setIndex) => {
              const row = document.createElement("tr");
              const setCell = document.createElement("td");
              setCell.textContent = setIndex + 1;
              row.appendChild(setCell);
              const weightCell = document.createElement("td");
              const weightInput = document.createElement("input");
              weightInput.type = "number";
              weightInput.value = exercise.weight || "";
              weightInput.placeholder = "무게";
              weightCell.appendChild(weightInput);
              row.appendChild(weightCell);
              const repsCell = document.createElement("td");
              const repsInput = document.createElement("input");
              repsInput.type = "number";
              repsInput.value = exercise.reps || "";
              repsInput.placeholder = "횟수";
              repsCell.appendChild(repsInput);
              row.appendChild(repsCell);
              exerciseTableBody.appendChild(row);
            });

            // 피드백 로드
            document.getElementById(`exerciseDescription${groupIndex}`).value =
              groupData.feedback || "";
          }
        }

        // 유튜브 검색
        window.searchYouTube = function (index) {
          const exerciseName = document.getElementById(
            `exerciseName${index}`
          ).value;
          if (exerciseName) {
            const searchQuery = encodeURIComponent(exerciseName);
            const youtubeUrl = `https://www.youtube.com/results?search_query=${searchQuery}`;
            window.open(youtubeUrl, "_blank");
          } else {
            alert("운동 이름을 입력해주세요.");
          }
        };

        // 운동 그룹 제거
        window.handleRemoveGroup = function (groupId) {
          const groupDiv = document.getElementById(groupId);
          if (groupDiv) {
            // 인덱스 추출 및 집합에서 제거
            const index = parseInt(groupId.replace("exerciseGroup", ""), 10);
            availableIndexes.delete(index);

            exerciseGroupsContainer.removeChild(groupDiv);
          }
        };

        // 레슨 데이터 저장
        saveLessonBtn.addEventListener("click", async function () {
          const clientId = getClientId();
          if (!clientId) {
            alert("클라이언트 ID를 찾을 수 없습니다.");
            return;
          }

          const lessonId = lessonIdInput.value;
          const nextLesson = document.querySelector(
            ".next_lesson textarea"
          ).value; // 다음 회차 예정 수업 내용

          const exerciseGroups = Array.from(
            exerciseGroupsContainer.children
          ).map((groupDiv) => {
            const index = groupDiv.id.replace("exerciseGroup", "");
            const exerciseNameElement = document.getElementById(
              `exerciseName${index}`
            );
            const exerciseBodyPartElement = document.getElementById(
              `exerciseBodyPart1${index}`
            );
            const exerciseTableBody = document.getElementById(
              `exerciseTableBody${index}`
            );
            const exerciseDescriptionElement = document.getElementById(
              `exerciseDescription${index}`
            );

            return {
              name: exerciseNameElement ? exerciseNameElement.value : "",
              bodyPart: exerciseBodyPartElement
                ? exerciseBodyPartElement.value
                : "",
              exercises: Array.from(
                exerciseTableBody ? exerciseTableBody.children : []
              ).map((row) => {
                const weightInput = row.children[1].querySelector("input");
                const repsInput = row.children[2].querySelector("input");
                return {
                  weight: weightInput ? weightInput.value : "",
                  reps: repsInput ? repsInput.value : "",
                };
              }),
              feedback: exerciseDescriptionElement
                ? exerciseDescriptionElement.value
                : "",
            };
          });

          const lessonData = {
            clientId: clientId,
            exerciseGroups: exerciseGroups,
            lessonIndex: document
              .getElementById("clientName")
              .textContent.replace("회차 레슨 일지", "")
              .trim(),
            nextLesson: nextLesson, // 추가된 필드
          };

          try {
            if (lessonId) {
              await db.collection("lessons").doc(lessonId).update(lessonData);
              alert("레슨이 업데이트되었습니다.");
            } else {
              await db.collection("lessons").add(lessonData);
              alert("새 레슨이 추가되었습니다.");
            }
            // window.location.href = "index.html"; // 데이터 저장 후 이동할 페이지
          } catch (error) {
            console.error("레슨 저장 중 오류 발생:", error);
            alert("레슨을 저장하는 중 오류가 발생했습니다.");
          }
        });

        // 새로운 운동 그룹 추가 버튼 클릭 이벤트
        addGroupBtn.addEventListener("click", function () {
          createExerciseGroup({}, null);
        });

        // 페이지 로드 시 레슨 데이터 로드
        loadLessonData();

        // URL에서 clientId를 추출하는 함수
        function getQueryParam(param) {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get(param);
        }
        // clientId를 URL에서 추출
        const clientId = getQueryParam("clientId");

        viewReadOnlyBtn.addEventListener("click", function () {
          const lessonId = lessonIdInput.value;
          if (lessonId) {
            window.location.href = `read_only.html?clientId=${clientId}&lessonId=${lessonId}`;
          } else {
            alert("레슨 ID를 찾을 수 없습니다.");
          }
        });
      });
      function logout() {
        window.location.href = "/index.html"; // 로그아웃 처리 페이지로 리다이렉트
      }
      // 뒤로 가기 버튼 클릭 이벤트
      function goBack() {
        window.history.back();
      }
      // 사용 가능한 인덱스를 저장할 집합
      const availableIndexes = new Set();
    </script>
    <script>
      let exerciseGroupCount = 1; // 운동 그룹의 수

      // 각 부위에 해당하는 운동 리스트
      const exerciseLists = {
        가슴: [
          {
            name: "벤치 프레스",
            link: "https://www.youtube.com/results?search_query=벤치+프레스",
          },
          {
            name: "푸쉬업",
            link: "https://www.youtube.com/results?search_query=푸쉬업",
          },
          {
            name: "덤벨 플라이",
            link: "https://www.youtube.com/results?search_query=덤벨+플라이",
          },
          {
            name: "인클라인 벤치프레스",
            link: "https://www.youtube.com/results?search_query=인클라인+벤치프레스",
          },
          {
            name: "케이블 크로스오버",
            link: "https://www.youtube.com/results?search_query=케이블+크로스오버",
          },
          {
            name: "딥스",
            link: "https://www.youtube.com/results?search_query=딥스",
          },
          {
            name: "덤벨 벤치프레스",
            link: "https://www.youtube.com/results?search_query=덤벨+벤치프레스",
          },
          {
            name: "케이블 풀오버",
            link: "https://www.youtube.com/results?search_query=케이블+풀오버",
          },
          {
            name: "체스트 프레스 머신",
            link: "https://www.youtube.com/results?search_query=체스트+프레스+머신",
          },
          {
            name: "덤벨 풀오버",
            link: "https://www.youtube.com/results?search_query=덤벨+풀오버",
          },
        ],
        등: [
          {
            name: "랫 풀다운",
            link: "https://www.youtube.com/results?search_query=랫+풀다운",
          },
          {
            name: "바벨 로우",
            link: "https://www.youtube.com/results?search_query=바벨+로우",
          },
          {
            name: "풀업",
            link: "https://www.youtube.com/results?search_query=풀업",
          },
          {
            name: "덤벨 로우",
            link: "https://www.youtube.com/results?search_query=덤벨+로우",
          },
          {
            name: "시티드 로우",
            link: "https://www.youtube.com/results?search_query=시티드+로우",
          },
          {
            name: "원암 덤벨 로우",
            link: "https://www.youtube.com/results?search_query=원암+덤벨+로우",
          },
          {
            name: "투암 덤벨 로우",
            link: "https://www.youtube.com/results?search_query=투암+덤벨+로우",
          },
          {
            name: "롱풀",
            link: "https://www.youtube.com/results?search_query=롱풀",
          },
          {
            name: "로잉 머신",
            link: "https://www.youtube.com/results?search_query=로잉+머신",
          },
        ],
        하체: [
          {
            name: "스쿼트",
            link: "https://www.youtube.com/results?search_query=스쿼트",
          },
          {
            name: "파워 레그 프레스",
            link: "https://www.youtube.com/results?search_query=파워+레그+프레스",
          },
          {
            name: "런지",
            link: "https://www.youtube.com/results?search_query=런지",
          },
          {
            name: "레그 컬",
            link: "https://www.youtube.com/results?search_query=레그+컬",
          },
          {
            name: "레그 익스텐션",
            link: "https://www.youtube.com/results?search_query=레그+익스텐션",
          },
          {
            name: "힙 쓰러스트",
            link: "https://www.youtube.com/results?search_query=힙+쓰러스트",
          },
          {
            name: "몬스터 글루트 머신",
            link: "https://www.youtube.com/results?search_query=몬스터+글루트+머신",
          },
          {
            name: "힙 브릿지",
            link: "https://www.youtube.com/results?search_query=힙+브릿지",
          },
          {
            name: "스모 스쿼트",
            link: "https://www.youtube.com/results?search_query=스모+스쿼트",
          },
          {
            name: "와이드 스쿼트",
            link: "https://www.youtube.com/results?search_query=와이드+스쿼트",
          },
        ],
        어깨: [
          {
            name: "밀리터리 프레스",
            link: "https://www.youtube.com/results?search_query=밀리터리+프레스",
          },
          {
            name: "사이드 레터럴 레이즈",
            link: "https://www.youtube.com/results?search_query=사이드+레터럴+레이즈",
          },
          {
            name: "리어 델트 플라이",
            link: "https://www.youtube.com/results?search_query=리어+델트+플라이",
          },
          {
            name: "프론트 레이즈",
            link: "https://www.youtube.com/results?search_query=프론트+레이즈",
          },
          {
            name: "덤벨 숄더 프레스",
            link: "https://www.youtube.com/results?search_query=덤벨+숄더+프레스",
          },
          {
            name: "업라이트 로우",
            link: "https://www.youtube.com/results?search_query=업라이트+로우",
          },
          {
            name: "바벨 쉬러그",
            link: "https://www.youtube.com/results?search_query=바벨+쉬러그",
          },
          {
            name: "덤벨 쉬러그",
            link: "https://www.youtube.com/results?search_query=덤벨+쉬러그",
          },
          {
            name: "비하인드 넥 프레스",
            link: "https://www.youtube.com/results?search_query=비하인드+넥+프레스",
          },
          {
            name: "벤트 오버 레터럴 레이즈",
            link: "https://www.youtube.com/results?search_query=벤트+오버+레터럴+레이즈",
          },
        ],
        복근: [
          {
            name: "크런치",
            link: "https://www.youtube.com/results?search_query=크런치",
          },
          {
            name: "레그 레이즈",
            link: "https://www.youtube.com/results?search_query=레그+레이즈",
          },
          {
            name: "플랭크",
            link: "https://www.youtube.com/results?search_query=플랭크",
          },
          {
            name: "바이시클 크런치",
            link: "https://www.youtube.com/results?search_query=바이시클+크런치",
          },
          {
            name: "행잉 레그 레이즈",
            link: "https://www.youtube.com/results?search_query=행잉+레그+레이즈",
          },
          {
            name: "케이블 크런치",
            link: "https://www.youtube.com/results?search_query=케이블+크런치",
          },
          {
            name: "V-싯업",
            link: "https://www.youtube.com/results?search_query=V-싯업",
          },
          {
            name: "벤치 싯업",
            link: "https://www.youtube.com/results?search_query=벤치+싯업",
          },
        ],
        이두: [
          {
            name: "바벨 컬",
            link: "https://www.youtube.com/results?search_query=바벨+컬",
          },
          {
            name: "덤벨 컬",
            link: "https://www.youtube.com/results?search_query=덤벨+컬",
          },
          {
            name: "해머 컬",
            link: "https://www.youtube.com/results?search_query=해머+컬",
          },
          {
            name: "프리쳐 컬",
            link: "https://www.youtube.com/results?search_query=프리쳐+컬",
          },
          {
            name: "케이블 컬",
            link: "https://www.youtube.com/results?search_query=케이블+컬",
          },
          {
            name: "바벨 드래그 컬",
            link: "https://www.youtube.com/results?search_query=바벨+드래그+컬",
          },
          {
            name: "바벨 리스트 컬",
            link: "https://www.youtube.com/results?search_query=바벨+리스트+컬",
          },
          {
            name: "콘센트레이션 컬",
            link: "https://www.youtube.com/results?search_query=콘센트레이션+컬",
          },
        ],
        삼두: [
          {
            name: "케이블 로프 푸쉬다운",
            link: "https://www.youtube.com/results?search_query=케이블+로프+푸쉬다운",
          },
          {
            name: "딥스",
            link: "https://www.youtube.com/results?search_query=딥스",
          },
          {
            name: "킥백",
            link: "https://www.youtube.com/results?search_query=킥백",
          },
          {
            name: "오버헤드 트라이셉스 익스텐션",
            link: "https://www.youtube.com/results?search_query=오버헤드+트라이셉스+익스텐션",
          },
          {
            name: "클로즈 그립 벤치프레스",
            link: "https://www.youtube.com/results?search_query=클로즈+그립+벤치프레스",
          },
          {
            name: "원암 덤벨 오버헤드 익스텐션",
            link: "https://www.youtube.com/results?search_query=원암+덤벨+오버헤드+익스텐션",
          },
          {
            name: "라잉 익스텐션",
            link: "https://www.youtube.com/results?search_query=라잉+익스텐션",
          },
        ],
        유산소: [
          {
            name: "트레드밀",
            link: "https://www.youtube.com/results?search_query=트레드밀",
          },
          {
            name: "천국의 계단",
            link: "https://www.youtube.com/results?search_query=천국의+계단",
          },
          {
            name: "좌식 사이클",
            link: "https://www.youtube.com/results?search_query=좌식+사이클",
          },
          {
            name: "입식 사이클",
            link: "https://www.youtube.com/results?search_query=입식+사이클",
          },
          {
            name: "일랩티컬",
            link: "https://www.youtube.com/results?search_query=일랩티컬",
          },
          {
            name: "조깅",
            link: "https://www.youtube.com/results?search_query=조깅",
          },
          {
            name: "수영",
            link: "https://www.youtube.com/results?search_query=수영",
          },
          {
            name: "마라톤",
            link: "https://www.youtube.com/results?search_query=마라톤",
          },
        ],
      };

      function showExercises() {
        const muscle = document.getElementById("muscle-select").value;
        const container = document.getElementById("exercise-container");
        container.innerHTML = ""; // 기존 내용 지우기

        if (muscle) {
          exercises[muscle].forEach((exercise) => {
            const button = document.createElement("a");
            button.textContent = exercise;
            button.className = "exercise-button";
            button.href = getYouTubeSearchURL(exercise);
            button.target = "_blank"; // 새 탭에서 열기
            container.appendChild(button);
          });
        }
      }

      // 운동 부위 선택에 따라 추천 운동을 표시하는 함수
      function recommendExercise(selectElement) {
        const selectedBodyPart = selectElement.value;
        const recommendationDiv = selectElement
          .closest(".exercise-group")
          .querySelector(".exercise-recommendation");

        if (selectedBodyPart && exerciseLists[selectedBodyPart]) {
          const randomExercises = exerciseLists[selectedBodyPart]
            .sort(() => 0.5 - Math.random()) // 무작위로 섞음
            .slice(0, 3); // 상위 3개 선택

          // 추천 운동을 HTML 링크로 만들어서 표시
          recommendationDiv.innerHTML = "<strong>추천 운동:</strong><br>";
          randomExercises.forEach((exercise) => {
            const link = document.createElement("a");
            link.href = exercise.link; // 링크를 올바르게 참조
            link.textContent = exercise.name;
            link.target = "_blank"; // 링크를 새 탭에서 열기
            recommendationDiv.appendChild(link);
            recommendationDiv.appendChild(document.createElement("br")); // 줄바꿈
          });
        } else {
          recommendationDiv.innerHTML = ""; // 선택 안 했을 때 추천 초기화
        }
      }
    </script>
  </body>
</html>
